"use strict";(self.webpackChunkexpo_iap_docs=self.webpackChunkexpo_iap_docs||[]).push([[2496],{571:(e,r,n)=>{n.d(r,{A:()=>o});var s=n(6540),c=n(4848);function i({className:e="adfit",style:r,unit:n,height:i,width:o}){return(0,s.useEffect)(()=>{const r=setTimeout(()=>{const r=document.querySelector(`.${e}`);if(!r)return void console.warn(`AdFit: Element with class "${e}" not found`);const s=r.querySelectorAll(".kakao_ad_area"),c=r.querySelectorAll('script[src*="kas/static/ba.min.js"]');s.forEach(e=>e.remove()),c.forEach(e=>e.remove());const t=document.createElement("ins"),d=document.createElement("script");t.className="kakao_ad_area",t.style.cssText="display:none; width:100%;",d.async=!0,d.type="text/javascript",d.src="//t1.daumcdn.net/kas/static/ba.min.js",t.setAttribute("data-ad-width",o.toString()),t.setAttribute("data-ad-height",i.toString()),t.setAttribute("data-ad-unit",n),r.appendChild(t),r.appendChild(d)},100);return()=>clearTimeout(r)},[e,n,i,o]),(0,c.jsx)("div",{style:r,children:(0,c.jsx)("div",{className:e})})}function o(){return(0,c.jsx)(i,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},941:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"api/use-iap","title":"useIAP Hook","description":"The useIAP hook is the main interface for interacting with in-app purchases in Expo IAP. It provides a comprehensive API for managing purchases, subscriptions, and error handling.","source":"@site/docs/api/use-iap.md","sourceDirName":"api","slug":"/api/use-iap","permalink":"/docs/api/use-iap","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/expo-iap/tree/main/docs/docs/api/use-iap.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"useIAP Hook","sidebar_label":"useIAP Hook","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Listeners","permalink":"/docs/api/methods/listeners"},"next":{"title":"Error Codes","permalink":"/docs/api/error-codes"}}');var c=n(4848),i=n(8453),o=n(571);const t={title:"useIAP Hook",sidebar_label:"useIAP Hook",sidebar_position:1},d="useIAP Hook",l={},a=[{value:"Import",id:"import",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"useIAP(options)",id:"useiapoptions",level:3},{value:"UseIAPOptions",id:"useiapoptions-1",level:4},{value:"Configuration Properties",id:"configuration-properties",level:3},{value:"onPurchaseSuccess",id:"onpurchasesuccess",level:4},{value:"onPurchaseError",id:"onpurchaseerror",level:4},{value:"onSyncError",id:"onsyncerror",level:4},{value:"autoFinishTransactions",id:"autofinishtransactions",level:4},{value:"Return Values",id:"return-values",level:2},{value:"State Properties",id:"state-properties",level:3},{value:"connected",id:"connected",level:4},{value:"products",id:"products",level:4},{value:"subscriptions",id:"subscriptions",level:4},{value:"currentPurchase",id:"currentpurchase",level:4},{value:"currentPurchaseError",id:"currentpurchaseerror",level:4},{value:"purchaseHistories",id:"purchasehistories",level:4},{value:"availablePurchases",id:"availablepurchases",level:4},{value:"promotedProductIOS",id:"promotedproductios",level:4},{value:"Methods",id:"methods",level:3},{value:"requestProducts",id:"requestproducts",level:4},{value:"getProducts (Deprecated)",id:"getproducts-deprecated",level:4},{value:"getSubscriptions (Deprecated)",id:"getsubscriptions-deprecated",level:4},{value:"requestPurchase",id:"requestpurchase",level:4},{value:"getPurchaseHistories",id:"getpurchasehistories",level:4},{value:"getAvailablePurchases",id:"getavailablepurchases",level:4},{value:"validateReceipt",id:"validatereceipt",level:4},{value:"getPromotedProductIOS",id:"getpromotedproductios",level:4},{value:"buyPromotedProductIOS",id:"buypromotedproductios",level:4},{value:"Platform-Specific Usage",id:"platform-specific-usage",level:2},{value:"iOS Example",id:"ios-example",level:3},{value:"Android Example",id:"android-example",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Promoted Products (iOS Only)",id:"promoted-products-ios-only",level:2},{value:"See Also",id:"see-also",level:2}];function u(e){const r={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"useiap-hook",children:"useIAP Hook"})}),"\n",(0,c.jsx)(o.A,{}),"\n",(0,c.jsxs)(r.p,{children:["The ",(0,c.jsx)(r.code,{children:"useIAP"})," hook is the main interface for interacting with in-app purchases in Expo IAP. It provides a comprehensive API for managing purchases, subscriptions, and error handling."]}),"\n",(0,c.jsx)(r.h2,{id:"import",children:"Import"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"import {useIAP} from 'expo-iap';\n"})}),"\n",(0,c.jsx)(r.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const {\n  connected,\n  products,\n  subscriptions,\n  currentPurchase,\n  currentPurchaseError,\n  getProducts,\n  getSubscriptions,\n  requestPurchase,\n  validateReceipt,\n} = useIAP({\n  onPurchaseSuccess: (purchase) => {\n    console.log('Purchase successful:', purchase);\n  },\n  onPurchaseError: (error) => {\n    console.error('Purchase failed:', error);\n  },\n  onSyncError: (error) => {\n    console.warn('Sync error:', error);\n  },\n});\n"})}),"\n",(0,c.jsx)(r.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,c.jsx)(r.h3,{id:"useiapoptions",children:"useIAP(options)"}),"\n",(0,c.jsxs)(r.table,{children:[(0,c.jsx)(r.thead,{children:(0,c.jsxs)(r.tr,{children:[(0,c.jsx)(r.th,{children:"Parameter"}),(0,c.jsx)(r.th,{children:"Type"}),(0,c.jsx)(r.th,{children:"Required"}),(0,c.jsx)(r.th,{children:"Description"})]})}),(0,c.jsx)(r.tbody,{children:(0,c.jsxs)(r.tr,{children:[(0,c.jsx)(r.td,{children:(0,c.jsx)(r.code,{children:"options"})}),(0,c.jsx)(r.td,{children:(0,c.jsx)(r.code,{children:"UseIAPOptions"})}),(0,c.jsx)(r.td,{children:"No"}),(0,c.jsx)(r.td,{children:"Configuration object"})]})})]}),"\n",(0,c.jsx)(r.h4,{id:"useiapoptions-1",children:"UseIAPOptions"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"interface UseIAPOptions {\n  onPurchaseSuccess?: (purchase: Purchase) => void;\n  onPurchaseError?: (error: PurchaseError) => void;\n  onSyncError?: (error: Error) => void;\n  autoFinishTransactions?: boolean; // Default: true\n}\n"})}),"\n",(0,c.jsx)(r.h3,{id:"configuration-properties",children:"Configuration Properties"}),"\n",(0,c.jsx)(r.h4,{id:"onpurchasesuccess",children:"onPurchaseSuccess"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(purchase: Purchase) => void"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Called when a purchase completes successfully"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"onPurchaseSuccess: (purchase) => {\n  // Grant user access to purchased content\n  unlockFeature(purchase.productId);\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"onpurchaseerror",children:"onPurchaseError"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(error: PurchaseError) => void"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Called when a purchase fails"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"onPurchaseError: (error) => {\n  if (error.code !== ErrorCode.E_USER_CANCELLED) {\n    Alert.alert('Purchase Failed', error.message);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"onsyncerror",children:"onSyncError"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(error: Error) => void"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Called when there's an error syncing with the store"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"onSyncError: (error) => {\n  console.warn('Store sync error:', error.message);\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"autofinishtransactions",children:"autoFinishTransactions"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"boolean"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Default"}),": ",(0,c.jsx)(r.code,{children:"true"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Whether to automatically finish transactions after successful purchases"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"return-values",children:"Return Values"}),"\n",(0,c.jsx)(r.h3,{id:"state-properties",children:"State Properties"}),"\n",(0,c.jsx)(r.h4,{id:"connected",children:"connected"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"boolean"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Whether the IAP service is connected and ready"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"if (connected) {\n  // Safe to make IAP calls\n  getProducts(['product.id']);\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"products",children:"products"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"Product[]"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Array of available products"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"products.map((product) => <ProductItem key={product.id} product={product} />);\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"subscriptions",children:"subscriptions"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"SubscriptionProduct[]"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Array of available subscription products"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"subscriptions.map((subscription) => (\n  <SubscriptionItem key={subscription.id} subscription={subscription} />\n));\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"currentpurchase",children:"currentPurchase"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"Purchase | null"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Currently active purchase (if any)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"useEffect(() => {\n  if (currentPurchase) {\n    processPurchase(currentPurchase);\n  }\n}, [currentPurchase]);\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"currentpurchaseerror",children:"currentPurchaseError"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"PurchaseError | null"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Current purchase error (if any)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"useEffect(() => {\n  if (currentPurchaseError) {\n    handlePurchaseError(currentPurchaseError);\n  }\n}, [currentPurchaseError]);\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"purchasehistories",children:"purchaseHistories"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"ProductPurchase[]"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Array of purchase history items"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"purchaseHistories.map((purchase) => (\n  <PurchaseHistoryItem key={purchase.transactionId} purchase={purchase} />\n));\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"availablepurchases",children:"availablePurchases"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"ProductPurchase[]"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Array of available purchases (restorable items)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"availablePurchases.map((purchase) => (\n  <RestorableItem key={purchase.transactionId} purchase={purchase} />\n));\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"promotedproductios",children:"promotedProductIOS"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"Product | undefined"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": The promoted product details (iOS only)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"useEffect(() => {\n  if (promotedProductIOS) {\n    // Handle promoted product\n    handlePromotedProduct(promotedProductIOS);\n  }\n}, [promotedProductIOS]);\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"methods",children:"Methods"}),"\n",(0,c.jsx)(r.h4,{id:"requestproducts",children:"requestProducts"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(params: RequestProductsParams) => Promise<Product[]>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Fetch products or subscriptions from the store"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Parameters"}),":","\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"params"}),": Object containing:","\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"skus"}),": Array of product/subscription IDs to fetch"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"type"}),": Product type - either ",(0,c.jsx)(r.code,{children:"'inapp'"})," for products or ",(0,c.jsx)(r.code,{children:"'subs'"})," for subscriptions"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Returns"}),": Promise resolving to array of products"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"// Fetch in-app products\nconst fetchProducts = async () => {\n  try {\n    const products = await requestProducts({\n      skus: ['com.app.premium', 'com.app.coins_100'],\n      type: 'inapp'\n    });\n    console.log('Fetched products:', products);\n  } catch (error) {\n    console.error('Failed to fetch products:', error);\n  }\n};\n\n// Fetch subscriptions\nconst fetchSubscriptions = async () => {\n  try {\n    const subs = await requestProducts({\n      skus: ['com.app.premium_monthly', 'com.app.premium_yearly'],\n      type: 'subs'\n    });\n    console.log('Fetched subscriptions:', subs);\n  } catch (error) {\n    console.error('Failed to fetch subscriptions:', error);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"getproducts-deprecated",children:"getProducts (Deprecated)"}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"\u26a0\ufe0f DEPRECATED:"})," This method is deprecated. Use ",(0,c.jsx)(r.code,{children:"requestProducts({ skus, type: 'inapp' })"})," instead."]}),"\n"]}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(productIds: string[]) => Promise<Product[]>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Migration"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"// Old way (deprecated)\nconst products = await getProducts(['product1', 'product2']);\n\n// New way\nconst products = await requestProducts({\n  skus: ['product1', 'product2'],\n  type: 'inapp'\n});\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"getsubscriptions-deprecated",children:"getSubscriptions (Deprecated)"}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"\u26a0\ufe0f DEPRECATED:"})," This method is deprecated. Use ",(0,c.jsx)(r.code,{children:"requestProducts({ skus, type: 'subs' })"})," instead."]}),"\n"]}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(subscriptionIds: string[]) => Promise<SubscriptionProduct[]>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Migration"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"// Old way (deprecated)\nconst subs = await getSubscriptions(['sub1', 'sub2']);\n\n// New way\nconst subs = await requestProducts({\n  skus: ['sub1', 'sub2'],\n  type: 'subs'\n});\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"requestpurchase",children:"requestPurchase"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(request: RequestPurchaseProps) => Promise<void>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Initiate a purchase request"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Parameters"}),":","\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"request"}),": Purchase request configuration"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const buyProduct = async (productId: string) => {\n  try {\n    await requestPurchase({\n      request: {\n        ios: { sku: productId },\n        android: { skus: [productId] }\n      },\n    });\n  } catch (error) {\n    console.error('Purchase request failed:', error);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"getpurchasehistories",children:"getPurchaseHistories"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"() => Promise<void>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Fetch purchase history from the store"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const fetchPurchaseHistory = async () => {\n  try {\n    await getPurchaseHistories();\n    console.log('Purchase history fetched:', purchaseHistories);\n  } catch (error) {\n    console.error('Failed to fetch purchase history:', error);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"getavailablepurchases",children:"getAvailablePurchases"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"() => Promise<void>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Fetch available purchases (restorable items) from the store"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const restorePurchases = async () => {\n  try {\n    await getAvailablePurchases();\n    console.log('Available purchases:', availablePurchases);\n  } catch (error) {\n    console.error('Failed to fetch available purchases:', error);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"validatereceipt",children:"validateReceipt"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"(productId: string, params?: ValidationParams) => Promise<ValidationResult>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Validate a purchase receipt"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Parameters"}),":","\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"productId"}),": ID of the product to validate"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"params"}),": ",(0,c.jsx)(r.strong,{children:"Required for Android"}),", optional for iOS:","\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"packageName"})," (string, Android): Package name of your app"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"productToken"})," (string, Android): Purchase token from the purchase"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"accessToken"})," (string, Android): Optional access token for server validation"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"isSub"})," (boolean, Android): Whether this is a subscription"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Returns"}),": Promise resolving to validation result"]}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:(0,c.jsx)(r.strong,{children:"Important Platform Differences:"})}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"iOS"}),": Only requires the product ID"]}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"Android"}),": Requires additional parameters (packageName, productToken)"]}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const validatePurchase = async (productId: string, purchase: any) => {\n  try {\n    if (Platform.OS === 'ios') {\n      // iOS: Simple validation with just product ID\n      const result = await validateReceipt(productId);\n      return result;\n    } else if (Platform.OS === 'android') {\n      // Android: Requires additional parameters\n      const purchaseToken = purchase.purchaseTokenAndroid;\n      const packageName = purchase.packageNameAndroid;\n      \n      if (!purchaseToken || !packageName) {\n        throw new Error('Android validation requires packageName and productToken');\n      }\n      \n      const result = await validateReceipt(productId, {\n        packageName,\n        productToken: purchaseToken,\n        isSub: false, // Set to true for subscriptions\n      });\n      return result;\n    }\n  } catch (error) {\n    console.error('Validation failed:', error);\n    throw error;\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"getpromotedproductios",children:"getPromotedProductIOS"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"() => Promise<any | null>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Get the promoted product details (iOS only)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const handlePromotedProduct = async () => {\n  const promotedProduct = await getPromotedProductIOS();\n  if (promotedProduct) {\n    console.log('Promoted product:', promotedProduct);\n    // Show custom purchase UI\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h4,{id:"buypromotedproductios",children:"buyPromotedProductIOS"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Type"}),": ",(0,c.jsx)(r.code,{children:"() => Promise<void>"})]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Description"}),": Complete the purchase of a promoted product (iOS only)"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Example"}),":","\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const completePurchase = async () => {\n  try {\n    await buyPromotedProductIOS();\n    console.log('Promoted product purchase completed');\n  } catch (error) {\n    console.error('Failed to purchase promoted product:', error);\n  }\n};\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"platform-specific-usage",children:"Platform-Specific Usage"}),"\n",(0,c.jsx)(r.h3,{id:"ios-example",children:"iOS Example"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const IOSPurchaseExample = () => {\n  const {connected, products, requestPurchase, validateReceipt} = useIAP({\n    onPurchaseSuccess: async (purchase) => {\n      // Validate receipt on iOS\n      const validation = await validateReceipt(purchase.productId);\n      if (validation.isValid) {\n        unlockContent(purchase.productId);\n      }\n    },\n  });\n\n  const buyProduct = (product: Product) => {\n    requestPurchase({\n      request: {\n        ios: { sku: product.id },\n        android: { skus: [product.id] }\n      },\n    });\n  };\n\n  return (\n    <View>\n      {products\n        .filter((p) => p.platform === 'ios')\n        .map((product) => (\n          <Button\n            key={product.id}\n            title={`${product.title} - ${product.displayPrice}`}\n            onPress={() => buyProduct(product)}\n          />\n        ))}\n    </View>\n  );\n};\n"})}),"\n",(0,c.jsx)(r.h3,{id:"android-example",children:"Android Example"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const AndroidPurchaseExample = () => {\n  const {connected, products, requestPurchase} = useIAP({\n    onPurchaseSuccess: (purchase) => {\n      // Android purchases are automatically validated by Google Play\n      unlockContent(purchase.productId);\n    },\n  });\n\n  const buyProduct = (product: Product) => {\n    requestPurchase({\n      request: {\n        ios: { sku: product.id },\n        android: { skus: [product.id] }\n      },\n    });\n  };\n\n  return (\n    <View>\n      {products\n        .filter((p) => p.platform === 'android')\n        .map((product) => (\n          <Button\n            key={product.id}\n            title={`${product.title} - ${product.oneTimePurchaseOfferDetails?.formattedPrice}`}\n            onPress={() => buyProduct(product)}\n          />\n        ))}\n    </View>\n  );\n};\n"})}),"\n",(0,c.jsx)(r.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,c.jsxs)(r.p,{children:["The ",(0,c.jsx)(r.code,{children:"useIAP"})," hook integrates with the centralized error handling system:"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const {requestPurchase} = useIAP({\n  onPurchaseError: (error) => {\n    // Error is automatically typed as PurchaseError\n    switch (error.code) {\n      case ErrorCode.E_USER_CANCELLED:\n        // Don't show error for user cancellation\n        break;\n      case ErrorCode.E_NETWORK_ERROR:\n        Alert.alert('Network Error', 'Please check your connection');\n        break;\n      case ErrorCode.E_ITEM_UNAVAILABLE:\n        Alert.alert(\n          'Item Unavailable',\n          'This item is not available for purchase',\n        );\n        break;\n      default:\n        Alert.alert('Purchase Failed', error.message);\n    }\n  },\n});\n"})}),"\n",(0,c.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsxs)(r.strong,{children:["Always check ",(0,c.jsx)(r.code,{children:"connected"})," before making IAP calls"]}),":"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"useEffect(() => {\n  if (connected) {\n    getProducts(productIds);\n  }\n}, [connected]);\n"})}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"Handle loading states"}),":"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const [loading, setLoading] = useState(false);\n\nconst buyProduct = async (productId: string) => {\n  setLoading(true);\n  try {\n    await requestPurchase({\n      request: {\n        ios: { sku: productId },\n        android: { skus: [productId] }\n      }\n    });\n  } finally {\n    setLoading(false);\n  }\n};\n"})}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"Implement proper error handling"}),":"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const handleError = (error: PurchaseError) => {\n  // Log for debugging\n  console.error('IAP Error:', error);\n\n  // Show user-friendly message\n  if (error.code !== ErrorCode.E_USER_CANCELLED) {\n    Alert.alert('Purchase Failed', error.message);\n  }\n};\n"})}),"\n"]}),"\n",(0,c.jsxs)(r.li,{children:["\n",(0,c.jsxs)(r.p,{children:[(0,c.jsx)(r.strong,{children:"Cache products to avoid repeated fetches"}),":"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const [productsLoaded, setProductsLoaded] = useState(false);\n\nuseEffect(() => {\n  if (connected && !productsLoaded) {\n    getProducts(productIds).then(() => {\n      setProductsLoaded(true);\n    });\n  }\n}, [connected, productsLoaded]);\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"promoted-products-ios-only",children:"Promoted Products (iOS Only)"}),"\n",(0,c.jsx)(r.p,{children:"Handle App Store promoted products when users tap on them in the App Store:"}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-tsx",children:"const PromotedProductExample = () => {\n  const {\n    promotedProductIOS,\n    buyPromotedProductIOS,\n  } = useIAP({\n    onPromotedProductIOS: (product) => {\n      console.log('Promoted product detected:', product);\n    },\n  });\n\n  useEffect(() => {\n    if (promotedProductIOS) {\n      handlePromotedProduct();\n    }\n  }, [promotedProductIOS]);\n\n  const handlePromotedProduct = async () => {\n    try {\n      // Show your custom purchase UI\n      const confirmed = await showPurchaseConfirmation(promotedProductIOS);\n      \n      if (confirmed) {\n        // Complete the promoted purchase\n        await buyPromotedProductIOS();\n      }\n    } catch (error) {\n      console.error('Error handling promoted product:', error);\n    }\n  };\n\n  const showPurchaseConfirmation = async (product: any) => {\n    return new Promise((resolve) => {\n      Alert.alert(\n        'Purchase Product',\n        `Would you like to purchase ${product.localizedTitle} for ${product.price}?`,\n        [\n          { text: 'Cancel', onPress: () => resolve(false), style: 'cancel' },\n          { text: 'Buy', onPress: () => resolve(true) },\n        ],\n      );\n    });\n  };\n\n  return (\n    <View>\n      {/* Your regular store UI */}\n    </View>\n  );\n};\n"})}),"\n",(0,c.jsx)(r.h2,{id:"see-also",children:"See Also"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"./error-codes",children:"Error Codes Reference"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"./types",children:"Types Reference"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"../guides/error-handling",children:"Error Handling Guide"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"../guides/lifecycle",children:"Purchase Flow Guide"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(u,{...e})}):u(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>t});var s=n(6540);const c={},i=s.createContext(c);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);